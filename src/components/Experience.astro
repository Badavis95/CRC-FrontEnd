---
import experienceData from '../data/experience.json';

function formatDate(dateStr: string | null): string {
  if (!dateStr) return 'Present';
  const date = new Date(dateStr + '-01');
  return date.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
}
---

<section id="experience" class="section">
  <div class="container-narrow">
    <h2 class="heading-section">
      <span class="text-[var(--color-accent)]">/</span> Experience
    </h2>

    <div class="space-y-8">
      {experienceData.experience.map((job, index) => (
        <article class="card relative overflow-hidden group">
          {job.current && (
            <div class="absolute top-4 right-4">
              <span class="text-xs px-3 py-1 rounded-full bg-[var(--color-accent)] text-[var(--color-bg-primary)] font-semibold">
                Current
              </span>
            </div>
          )}

          <div class="flex flex-col md:flex-row md:items-start gap-4 mb-4">
            <div class="flex-1">
              <h3 class="font-display font-bold text-xl text-[var(--color-text-primary)]">
                {job.role}
              </h3>
              <p class="text-[var(--color-accent)] font-semibold">
                {job.company}
              </p>
            </div>
            <div class="text-right">
              <p class="text-[var(--color-text-secondary)] font-display text-sm">
                {formatDate(job.startDate)} - {formatDate(job.endDate)}
              </p>
              <p class="text-[var(--color-text-muted)] text-sm">
                {job.location} {job.locationType && `(${job.locationType})`}
              </p>
            </div>
          </div>

          <p class="text-[var(--color-text-secondary)] mb-4">
            {job.description}
          </p>

          {job.achievements && job.achievements.length > 0 && (
            <div class="mb-4">
              <h4 class="font-semibold text-[var(--color-text-primary)] text-sm mb-2">Key Achievements:</h4>
              <ul class="space-y-2">
                {job.achievements.map((achievement) => (
                  <li class="text-[var(--color-text-secondary)] text-sm flex items-start gap-2">
                    <span class="text-[var(--color-accent)] mt-0.5">
                      <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"/>
                      </svg>
                    </span>
                    {achievement}
                  </li>
                ))}
              </ul>
            </div>
          )}

          <div class="flex flex-wrap gap-2">
            {job.technologies.map((tech) => (
              <span class="tag text-xs">{tech}</span>
            ))}
          </div>

          {job.note && (
            <p class="mt-4 text-[var(--color-text-muted)] text-sm italic border-l-2 border-[var(--color-accent)] pl-3">
              {job.note}
            </p>
          )}
        </article>
      ))}
    </div>
  </div>
</section>
