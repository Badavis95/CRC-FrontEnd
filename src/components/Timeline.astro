---
import timelineData from '../data/timeline.json';

const iconMap: Record<string, string> = {
  'shopping-bag': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/></svg>',
  'rocket': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z"/></svg>',
  'tv': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>',
  'refresh-cw': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>',
  'headphones': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/></svg>',
  'cpu': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"/></svg>',
  'award': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>',
  'terminal': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 9l3 3-3 3m5 0h3M5 20h14a2 2 0 002-2V6a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>',
  'arrow-right': '<svg class="w-5 h-5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>',
};

const typeColors: Record<string, string> = {
  'foundation': 'var(--color-text-muted)',
  'entrepreneurship': 'var(--color-warning)',
  'transition': 'var(--color-text-secondary)',
  'career': 'var(--color-success)',
  'ai': 'var(--color-accent)',
  'current': 'var(--color-accent)',
  'future': 'var(--color-accent)',
};
---

<section id="timeline" class="section bg-[var(--color-bg-secondary)]">
  <div class="container-narrow">
    <h2 class="heading-section">
      <span class="text-[var(--color-accent)]">/</span> My Journey
    </h2>

    <div class="relative">
      <div class="absolute left-4 md:left-1/2 top-0 bottom-0 w-0.5 bg-[var(--color-bg-tertiary)] md:-translate-x-1/2"></div>

      <div class="space-y-12">
        {timelineData.timeline.map((item, index) => (
          <div class={`timeline-item relative flex flex-col md:flex-row gap-8 ${index % 2 === 0 ? 'md:flex-row-reverse' : ''}`}>
            <div class="absolute left-4 md:left-1/2 w-8 h-8 rounded-full flex items-center justify-center -translate-x-1/2 z-10"
                 style={`background-color: ${item.highlight ? 'var(--color-accent)' : 'var(--color-bg-tertiary)'}; color: ${item.highlight ? 'var(--color-bg-primary)' : typeColors[item.type] || 'var(--color-text-secondary)'}`}>
              <Fragment set:html={iconMap[item.icon] || iconMap['arrow-right']} />
            </div>

            <div class="flex-1 md:w-1/2"></div>

            <div class={`flex-1 md:w-1/2 ml-12 md:ml-0 ${index % 2 === 0 ? 'md:pr-12 md:text-right' : 'md:pl-12'}`}>
              <div class={`card ${item.highlight ? 'border-l-4 md:border-l-0' : ''}`}
                   style={item.highlight ? `border-color: var(--color-accent)` : ''}>
                <span class="inline-block font-display font-bold text-lg mb-2"
                      style={`color: ${typeColors[item.type] || 'var(--color-accent)'}`}>
                  {item.year}
                </span>
                <h3 class="font-display font-bold text-xl text-[var(--color-text-primary)] mb-3">
                  {item.title}
                </h3>
                <p class="text-[var(--color-text-secondary)] leading-relaxed">
                  {item.description}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  </div>
</section>

<style>
  .timeline-item {
    opacity: 0;
    transform: translateY(20px);
    transition: all 0.5s ease-out;
  }

  .timeline-item.visible {
    opacity: 1;
    transform: translateY(0);
  }
</style>

<script>
  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach((entry) => {
        if (entry.isIntersecting) {
          entry.target.classList.add('visible');
        }
      });
    },
    { threshold: 0.1, rootMargin: '0px 0px -50px 0px' }
  );

  document.querySelectorAll('.timeline-item').forEach((item) => {
    observer.observe(item);
  });
</script>
